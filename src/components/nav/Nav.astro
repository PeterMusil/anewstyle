---
import NavItem from "./NavItem.astro";
import LangSwitch from "../langSwitch/LangSwitch.astro";
import Icon from "../icons/Icon.astro";
import { useTranslations, type Lang } from "../../i18n/utils";

interface Props {
  lang?: Lang;
}

const { lang = "cs" } = Astro.props;
const t = useTranslations(lang);

const basePath = lang === "cs" ? "" : "/en";
---

<nav>
  <div class="nav__container">
    <a href={`${basePath}/`} class="logo" rel="noopener">
      <img src="/images/logos/logo.svg" alt={t("common.logoAlt")} height="96" />
    </a>
    <ul class="menu">
      <NavItem href={`${basePath}/#about`} text={t("nav.light")} icon="bulp" />
      <NavItem
        href={`${basePath}/#products`}
        text={t("nav.products")}
        icon="ar"
        iconClass="icon-nav"
      />
      <NavItem
        href={`${basePath}/#technologies`}
        text={t("nav.technologies")}
      />
      <NavItem href={`${basePath}/#faq`} text={t("nav.faq")} />
      <NavItem href={`${basePath}/gallery`} text={t("nav.gallery")} />
      <NavItem href={`${basePath}/#price-list`} text={t("nav.price")} />
      <NavItem href={`${basePath}/#contact`} text={t("nav.contact")} />
    </ul>
    <ul class="nav__right">
      <li>
        <a
          href="http://www.anewstyle-eshop.cz/"
          target="_blank"
          rel="external"
          class="button button--s button--white"
        >
          <span>{t("nav.eshop")}</span>
          <Icon name="eshop" iconClass="icon-nav" />
        </a>
      </li>
      <LangSwitch lang={lang} />
      <li>
        <button aria-label={t("nav.mobileMenu")} class="burger" id="menuBtn">
          <Icon name="menu" />
        </button>
      </li>
    </ul>
  </div>
</nav>

<script>
  const initNav = () => {
    const menu = document.querySelector("nav .menu");
    const burger = document.getElementById("menuBtn");
    const navItems = document.querySelectorAll("nav .menu > li > a");

    if (!menu || !burger) return;

    const toggleMenu = () => {
      const isOpen = menu.getAttribute("data-open") === "true";
      menu.setAttribute("data-open", String(!isOpen));
      document.body.classList.toggle("overflow-hidden", !isOpen);
    };

    burger.onclick = toggleMenu;

    navItems.forEach((item) => {
      item.addEventListener("click", () => {
        menu.setAttribute("data-open", "false");
        document.body.classList.remove("overflow-hidden");
      });
    });
  };

  initNav();
  document.addEventListener("astro:page-load", initNav);
</script>
