---
import NavItem from "./NavItem.astro";
import LangSwitch from "../langSwitch/LangSwitch.astro";
import Icon from "../icons/Icon.astro";
import { useTranslations, getLocalizedPath, type Lang } from "../../i18n/utils";

interface Props {
  lang?: Lang;
}

const { lang = "cs" } = Astro.props;
const t = useTranslations(lang);

// Get localized paths
const basePath = lang === "cs" ? "" : "/en";
---

<nav>
  <div class="nav__container">
    <a href={`${basePath}/`} class="logo" rel="noopener">
      <img src="/images/logos/logo.svg" alt={t("common.logoAlt")} height="96" />
    </a>
    <ul class="menu">
      <NavItem href={`${basePath}/#about`} text={t("nav.light")} icon="bulp" />
      <NavItem
        href={`${basePath}/#products`}
        text={t("nav.products")}
        icon="ar"
        iconClass="icon-nav"
      />
      <NavItem
        href={`${basePath}/#technologies`}
        text={t("nav.technologies")}
      />
      <NavItem href={`${basePath}/#features`} text={t("nav.features")} />
      <NavItem href={`${basePath}/#price-list`} text={t("nav.price")} />
      <NavItem href={`${basePath}/gallery`} text={t("nav.gallery")} />
      <NavItem href={`${basePath}/#contact`} text={t("nav.contact")} />
      <li>
        <a
          href="http://www.anewstyle-eshop.cz/"
          target="_blank"
          rel="external"
          class="button button--xs button--white"
        >
          <span>{t("nav.eshop")}</span>
          <Icon name="eshop" iconClass="icon-nav" />
        </a>
      </li>
      <LangSwitch lang={lang} />
    </ul>
    <button aria-label={t("nav.mobileMenu")} class="burger" id="menuBtn">
      <Icon name="menu" />
    </button>
  </div>
</nav>

<style>
  @scope (.nav__container) {
    .nav-btn-eshop {
      /* Force button appearance, overriding global nav link styles */
      text-decoration: none !important;
      text-transform: uppercase !important;
      display: inline-flex !important;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: 0.8rem !important; /* Matches small text in screenshot */
      font-weight: 700;
      padding: 0.6em 1.5em !important;
      margin-left: 1em;
      background-color: white !important;
      color: black !important;
      border-radius: 9999px !important; /* Fully rounded/pill shape */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition:
        transform 0.2s ease,
        box-shadow 0.2s ease;
      letter-spacing: 0.05em;
    }

    .nav-btn-eshop:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    /* Ensure icon color override */
    .nav-btn-eshop :global(svg) {
      /* Assuming icon is SVG, force it to be dark/black if needed,
                though icon-nav class usually handles size and color might be inherited.
                If icon is not black by default, we force it. */
      color: black !important;
      fill: black !important;
    }
  }
</style>

<script>
  const menu = document.querySelector(".menu") as HTMLUListElement;
  const burger = document.querySelector("#menuBtn") as HTMLButtonElement;
  const body = document.body as HTMLBodyElement;
  const navItems = document.querySelectorAll(
    ".menu > li > a"
  ) as NodeListOf<HTMLAnchorElement>;

  burger &&
    menu &&
    burger.addEventListener("click", () => {
      const isOpen = menu.getAttribute("data-open") === "true";
      menu.setAttribute("data-open", String(!isOpen));
      body.classList.toggle("overflow-hidden", !isOpen);
    });

  menu &&
    navItems.forEach((item) => {
      item.addEventListener("click", () => {
        menu.setAttribute("data-open", "false");
        body.classList.remove("overflow-hidden");
      });
    });
</script>
