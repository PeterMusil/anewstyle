---
import {
  useTranslations,
  getLanguageSwitchPath,
  getLangShortLabel,
  type Lang,
} from "../../i18n/utils";

interface Props {
  lang?: Lang;
}

const { lang = "cs" } = Astro.props;
const t = useTranslations(lang);

// Get switch paths for each language
const csPath = getLanguageSwitchPath(Astro.url, "cs");
const enPath = getLanguageSwitchPath(Astro.url, "en");
---

<li>
  <div id="langSwitch" class="lang-switch">
    <button
      type="button"
      title={t("lang.select")}
      aria-label={t("lang.select")}
      class="button button--s button--white"
      id="langSwitchBtn"
    >
      <span>{getLangShortLabel(lang)}</span>
    </button>
    <div class="lang-switch__pop-up">
      <a
        href={csPath}
        class={`lang-switch__item ${lang === "cs" ? "active" : ""}`}
      >
        {t("lang.cs")}
      </a>
      <a
        href={enPath}
        class={`lang-switch__item ${lang === "en" ? "active" : ""}`}
      >
        {t("lang.en")}
      </a>
    </div>
  </div>
</li>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const langSwitchElem = document.querySelector(
      ".lang-switch__pop-up"
    ) as HTMLDivElement;
    const langSwitchBtn = document.getElementById(
      "langSwitchBtn"
    ) as HTMLButtonElement;

    if (langSwitchBtn && langSwitchElem) {
      langSwitchBtn.addEventListener("click", () => {
        langSwitchElem.classList.toggle("open");
      });

      document.addEventListener("click", (e) => {
        if (
          e.target !== langSwitchBtn &&
          !langSwitchBtn.contains(e.target as Node)
        ) {
          langSwitchElem.classList.remove("open");
        }
      });
    }
  });
</script>
